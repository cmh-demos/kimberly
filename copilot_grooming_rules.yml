---
# Grooming rules for Copilot
# Configuration for the manual grooming stage in CI workflows.

grooming_bot_settings:
  description: |
    Settings for the grooming runner, which is a manual CI stage.
    Grooming handles post-triage actions: assigning needs-info
    issues to copilot for info gathering, and moving
    Triaged+Backlog issues to the Backlog board column.
  script_path: "scripts/grooming_runner.py"
  workflow_path: ".github/workflows/grooming.yml"
  activation: "manual"  # Options: manual, scheduled, webhook
  schedule: "daily"  # For scheduled activation
  webhook_events: ["issues.labeled"]  # For webhook triggers
  needs_info_variants: ["needs-info"]  # Labels that trigger assignment
  assignee_for_needs_info: "copilot-bot"
  # When an item is marked 'needs_work' during triage/review, assign
  # it to the Copilot worker so the groomer automation can move it back
  # into an active column and drive follow-up work.
  assignee_for_needs_work: "copilot"
  remove_triaged_on_needs_info: true
  move_to_backlog_if_triaged_and_backlog: true
  project_board_integration: true  # Use project_management config
  audit_event_type: "grooming"
  dry_run_support: true  # Respects DRY_RUN env var
  # Maximum number of Copilot assignments allowed per run (total across
  # Backlog and In progress stages). Set to 1 to allow a single assign.
  max_copilot_assigns_per_run: 1
  # Labels considered groomable (case-insensitive). Issues must be in one
  # of these statuses to be processed by the groomer (project-card fallback
  # is used when labels are absent).
  groomable_status_labels: ["Backlog", "In progress"]
  stale_issue_handling:
    enabled: true
    labels_to_check: ["needs-info"]
    days_threshold: 14
    action: "close"  # or "comment", "label"
    close_comment: |
      This issue has been inactive for 14 days with needs-info label.
      Closing for now. Please reopen if you have more information.

  # Workflow automation settings
  workflow_automation:
    enabled: true
    description: |
      Automate issue state transitions across the project board based
      on labels, assignees, and conditions.
      Transitions follow the workflow: Backlog -> Ready -> In progress ->
      In review -> Done
    transitions:
      - name: "backlog_to_ready"
        description: "Move from Backlog to Ready when assigned to copilot-bot"
        from_column: "Backlog"
        to_column: "Ready"
        condition:
          labels: ["Backlog"]
          assignee: "copilot-bot"
          not_labels: ["ready", "in-progress", "in-review", "done"]

      - name: "ready_to_in_progress"
        description: |
          Move from Ready to In progress when PR is created (detected
          by in-progress label or assignee action)
        from_column: "Ready"
        to_column: "In progress"
        condition:
          labels: ["ready", "in-progress"]
          assignee: "copilot-bot"

      - name: "in_progress_to_in_review"
        description: "Move to In review when PR is opened for review"
        from_column: "In progress"
        to_column: "In review"
        condition:
          labels: ["in-progress", "in-review"]
          assignee: "copilot-bot"

      - name: "in_review_to_in_progress"
        description: "Kick back to In progress if review finds issues"
        from_column: "In review"
        to_column: "In progress"
        condition:
          labels: ["in-review", "needs_work"]
          # Expect the issue to be assigned to the copilot user when
          # moving back to In progress (set to `assignee_for_needs_work`)
          assignee: "copilot"

      - name: "in_review_to_done"
        description: "Move to Done when all reviews pass and ready for merge"
        from_column: "In review"
        to_column: "Done"
        condition:
          labels: ["in-review", "ready"]
          assignee: "copilot-bot"
          not_labels: ["needs_work", "blocked"]

  # Project board column IDs (must be configured for the specific project)
  project_columns:
    backlog: 12345678  # Replace with actual column ID
    ready: 87654321
    in_progress: 11223344
    in_review: 44332211
    done: 55667788
